Fix input bugs
Cleanup code
